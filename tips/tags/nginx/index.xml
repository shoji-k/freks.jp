<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>freks tips</title>
    <link>https://freks.jp/tips/tags/nginx/index.xml</link>
    <description>Recent content on freks tips</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>ja</language>
    <atom:link href="https://freks.jp/tips/tags/nginx/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>nginx</title>
      <link>https://freks.jp/tips/nginx/</link>
      <pubDate>Sun, 05 Feb 2017 10:43:20 +0900</pubDate>
      
      <guid>https://freks.jp/tips/nginx/</guid>
      <description>

&lt;h4 id=&#34;config-test&#34;&gt;config test&lt;/h4&gt;

&lt;p&gt;centos 7&lt;br /&gt;
$ sudo nginx -t&lt;/p&gt;

&lt;h4 id=&#34;initial&#34;&gt;initial&lt;/h4&gt;

&lt;p&gt;$ vim /etc/nginx/conf.d/default.conf&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;add server_tokens: off to html {}&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&#34;プロキシ設定&#34;&gt;プロキシ設定&lt;/h4&gt;

&lt;p&gt;$ vim /etc/nginx/conf.d/default.conf&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;upstream backend {
    server 127.0.0.1:8080;
}

server {
    listen       80;
    server_name  localhost;

    root /home/user/ws/docker/jitan/src/html;
    index index.php index.html index.htm;

    #error_page  404              /404.html;
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /usr/share/nginx/html;
    }

    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    location / {
        try_files $uri @app;
    }

    location ~* \.php$ {
        proxy_pass http://backend;
    }

    location @app {
        proxy_pass http://backend;
    }

    location ~ /\.ht {
        deny  all;
    }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;キャッシュプロキシ&#34;&gt;キャッシュプロキシ&lt;/h4&gt;

&lt;pre&gt;&lt;code&gt;http {
    proxy_cache_path /var/cache/nginx/cache levels=1:2 keys_zone=cachezone:60m max_size=1G inactive=7d;

    location ~* \.(html|css|jpg|gif|ico|js)$ {
        expires 1d;
        proxy_cache cachezone;
        proxy_cache_key $host$uri$is_args$args;
        proxy_cache_valid 200 301 302 1d;
        proxy_pass http://backend;
    }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;キャッシュを削除する&lt;/p&gt;

&lt;p&gt;cssを含むリンクのみ&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;grep -lr &amp;quot;css&amp;quot; /var/cache/nginx/ | xargs rm -f
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;特定のリンク&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;grep -lr &amp;quot;http://sample.com/&amp;quot; /var/cache/nginx/ | xargs rm -f
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;basic認証&#34;&gt;basic認証&lt;/h4&gt;

&lt;p&gt;htpasswdでパスワードファイルを作る&lt;/p&gt;

&lt;h5 id=&#34;centos7&#34;&gt;centos7&lt;/h5&gt;

&lt;p&gt;htpasswdをインストール&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ sudo yum install httpd-tools
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;$ sudo htpasswd -c /etc/nginx/.htpasswd username&lt;br /&gt;
$ sudo vim /etc/nginx/conf.d/default.conf&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;auth_basic &amp;quot;好きなrealmを&amp;quot;;
auth_basic_ user_file /etc/nginx/.htpasswd;
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
  </channel>
</rss>